---
title: "FSE Dashboard"
subtitle: "A subtitle"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
suppressPackageStartupMessages({
  library(fse)
  library(flexdashboard)
  library(dplyr)
  library(leaflet)
})

fetched_at <- Sys.time()
```





# FBOs for sale

```{r fbo-sale-data-test, eval=FALSE}
fbos <- data.frame(
  lon=c(50, -50) , 
  lat=c(-50, 50),
  label = letters[1:2],
  stringsAsFactors = FALSE
)
```

```{r fbo-sale-data-fetch, eval=FALSE}
fse::fse_fbo_for_sale() %>%
  saveRDS(file="fbos.rds")
```

```{r fbo-sale-data-load}
readRDS("fbos.rds") %>%
  left_join(icao_data, by=c("Icao"="icao")) %>%
  as_tibble() %>%
  mutate(
    popup = paste(
      Icao, 
      Airport, 
      paste0("Lots: ", Lots), 
      paste0("Gates: ", Gates), 
      paste0("Price: ", format(SellPrice, scientific = FALSE)),
      sep = "<br/>"
    )
  ) -> fbos
```

```{r map-fbo-for-sale}
ramp <- scales::gradient_n_pal(c("blue", "red"))
marker_color <- function(fbos) {
  ramp( scales::rescale(log(fbos$SellPrice), 0:1))
}

ramp2 <- colorNumeric(c("blue", "red"), domain=range(fbos$SellPrice))

icons <- awesomeIcons(
  icon = "ios-close",
  library = "ion",
  iconColor = ramp2(fbos$SellPrice)
)

fbos %>%
  leaflet() %>%
  addTiles() %>%
  addMarkers(
    lng = ~lon, 
    lat = ~lat, 
    popup = ~popup,
    icon = icons
  )
```



<!--
# FSE test

```{r fse-test}
head(icao_data)
```
-->
















# About

FSE data is fetched once every 24 hours. Present snapshot from **`r format(fetched_at, tz="UTC")` UTC**.

Submit issues to ...
